<template tag-name="crm-dashboard">
    <div class="page-container">

        <header class="page-header">
            <div class="header-left">
                <h1 class="title">Dashboard</h1>
            </div>
        </header>

        <template lyte-if="{{isLoading}}">
            <div class="loading-state">
                <div class="spinner"></div>
                <p>Loading dashboard...</p>
            </div>
        </template>

        <template lyte-else>

            <div class="dashboard-content">

                <div class="welcome-banner">
                    <h1>Welcome back, {{currentUser.fullName}}!</h1>
                    <p>Here's what's happening with your CRM today.</p>
                </div>

                <div class="quick-actions">
                    <template lyte-if="{{perms.DEAL_CREATE}}">
                        <button onclick="{{action('navigateTo', '#/deals/create')}}" class="quick-btn">
                            <div class="icon-box blue"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path></svg></div>
                            New Deal
                        </button>
                    </template>

                    <template lyte-if="{{perms.ACTIVITY_CREATE}}">
                        <button onclick="{{action('navigateTo', '#/activities/create')}}" class="quick-btn">
                            <div class="icon-box yellow"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></div>
                            New Activity
                        </button>
                    </template>

                    <template lyte-if="{{perms.COMPANY_CREATE}}">
                        <button onclick="{{action('navigateTo', '#/companies/create')}}" class="quick-btn">
                            <div class="icon-box green"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21h18"></path><path d="M5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16"></path></svg></div>
                            New Company
                        </button>
                    </template>

                    <template lyte-if="{{perms.CONTACT_CREATE}}">
                        <button onclick="{{action('navigateTo', '#/contacts/create')}}" class="quick-btn">
                            <div class="icon-box purple"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></div>
                            New Contact
                        </button>
                    </template>
                </div>

                <div class="stats-grid">
                    <template is="for" items="{{summaryStats}}" item="stat">
                        <div class="stat-card" onclick="{{action('navigateTo', stat.link)}}">
                            <div class="stat-header">
                                <div class="stat-icon {{stat.icon}}">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                                </div>
                            </div>
                            <div class="stat-value">{{stat.value}}</div>
                            <div class="stat-label">{{stat.label}}</div>
                        </div>
                    </template>
                </div>

                <template lyte-if="{{perms.VIEW_DEALS}}">
                    <div class="widget-card">
                        <div class="widget-header">
                            <h3 class="widget-title">Deal Pipeline</h3>
                            <button onclick="{{action('navigateTo', '#/deals')}}" class="btn-text">View All</button>
                        </div>
                        <div class="widget-body">
                            <div class="pipeline-grid">
                                <template is="for" items="{{pipelineStages}}" item="stage">
                                    <div class="pipeline-stage {{stage.cssClass}}">
                                        <div class="stage-val">{{stage.count}}</div>
                                        <div class="stage-lbl">{{stage.label}}</div>
                                    </div>
                                </template>
                            </div>

                            <div class="pipeline-footer">
                                <span class="label">Total Pipeline Value</span>
                                <span class="value">{{totalPipelineValue}}</span>
                            </div>
                        </div>
                    </div>
                </template>

            </div> </template>
    </div>
</template>